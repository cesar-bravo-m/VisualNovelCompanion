<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="VNC.SettingsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:VNC"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Settings"
    PrimaryButtonText="Save"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonClick="ContentDialog_PrimaryButtonClick"
    SecondaryButtonClick="ContentDialog_SecondaryButtonClick">

    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="600" MinWidth="500">
        <StackPanel Spacing="24" Margin="24">
            <!-- Intelligence Setting -->
            <StackPanel Spacing="12">
                <TextBlock Text="Intelligence" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <RadioButtons x:Name="IntelligenceRadioButtons" SelectionChanged="IntelligenceRadioButtons_SelectionChanged">
                    <RadioButton Content="Managed" Tag="managed" />
                    <RadioButton Content="BYOK" Tag="BYOK" />
                    <RadioButton Content="Local" Tag="local" />
                </RadioButtons>
            </StackPanel>

            <!-- Model Setting (only shown for BYOK and Local) -->
            <StackPanel x:Name="InputModePanel" Spacing="12" Visibility="Collapsed">
                <TextBlock Text="Input mode" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Spacing="8">
                    <!-- Image Option with Info -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <RadioButton x:Name="ImageRadioButton" Content="Image" Tag="Image" GroupName="ModelGroup" />
                        <Button x:Name="ImageInfoButton" 
                                Content="ⓘ" 
                                FontSize="14"
                                Width="24" 
                                Height="24"
                                Padding="0"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                                ToolTipService.ToolTip="Click for more information">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock Text="More tokens, more accurate" 
                                              TextWrapping="Wrap"
                                              MaxWidth="200"
                                              Style="{ThemeResource BodyTextBlockStyle}" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                    </StackPanel>
                    
                    <!-- OCR Option with Info -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <RadioButton x:Name="OCRRadioButton" Content="OCR" Tag="OCR" GroupName="ModelGroup" />
                        <Button x:Name="OCRInfoButton" 
                                Content="ⓘ" 
                                FontSize="14"
                                Width="24" 
                                Height="24"
                                Padding="0"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                                ToolTipService.ToolTip="Click for more information">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock Text="Less tokens, less accurate" 
                                              TextWrapping="Wrap"
                                              MaxWidth="200"
                                              Style="{ThemeResource BodyTextBlockStyle}" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </StackPanel>

            <!-- Managed Settings -->
            <Border x:Name="ManagedSettingsPanel" 
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource ControlElevationBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Visibility="Collapsed">
                <StackPanel Spacing="8">
                    <TextBlock Text="Translation will be handled by a remote server. No configuration is needed." 
                              TextWrapping="Wrap"
                              Style="{ThemeResource BodyTextBlockStyle}" />
                </StackPanel>
            </Border>

            <!-- BYOK Settings -->
            <Border x:Name="BYOKSettingsPanel" 
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource ControlElevationBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Visibility="Collapsed">
                <StackPanel Spacing="16">
                    <TextBlock Text="BYOK Configuration" Style="{ThemeResource BodyStrongTextBlockStyle}" />
                    
                    <!-- Together API Key -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Together API Key" Style="{ThemeResource BodyTextBlockStyle}" />
                        <PasswordBox x:Name="TogetherApiKeyBox" 
                                    PlaceholderText="Enter your Together API key"
                                    PasswordChanged="TogetherApiKeyBox_PasswordChanged" />
                    </StackPanel>

                    <!-- Together Model Selection -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Model" Style="{ThemeResource BodyTextBlockStyle}" />
                        <ComboBox x:Name="TogetherModelComboBox" 
                                 SelectionChanged="TogetherModelComboBox_SelectionChanged"
                                 HorizontalAlignment="Stretch">
                            <ComboBoxItem Content="google/gemma-3n-E4B-it" Tag="google/gemma-3n-E4B-it" />
                            <ComboBoxItem Content="meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8" Tag="meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8" />
                            <ComboBoxItem Content="meta-llama/Llama-4-Scout-17B-16E-Instruct" Tag="meta-llama/Llama-4-Scout-17B-16E-Instruct" />
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Local Settings -->
            <Border x:Name="LocalSettingsPanel" 
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource ControlElevationBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Visibility="Collapsed">
                <Grid>
                    <StackPanel x:Name="LocalSettingsContent" Spacing="16">
                        <TextBlock Text="Local Configuration" Style="{ThemeResource BodyStrongTextBlockStyle}" />
                        
                        <!-- Ollama Endpoint -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Ollama Endpoint" Style="{ThemeResource BodyTextBlockStyle}" />
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBox x:Name="OllamaEndpointBox" 
                                        PlaceholderText="http://localhost:11434"
                                        TextChanged="OllamaEndpointBox_TextChanged"
                                        MinWidth="250" />
                                <Button x:Name="AutoDetectButton" 
                                       Content="Auto-detect"
                                       Click="AutoDetectButton_Click" />
                                <Button x:Name="RefreshModelsButton" 
                                       Content="Refresh Models"
                                       Click="RefreshModelsButton_Click" />
                            </StackPanel>
                        </StackPanel>

                        <!-- Ollama Model Selection -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Ollama Model" Style="{ThemeResource BodyTextBlockStyle}" />
                            <ComboBox x:Name="OllamaModelComboBox" 
                                     SelectionChanged="OllamaModelComboBox_SelectionChanged"
                                     HorizontalAlignment="Stretch"
                                     PlaceholderText="Select an Ollama model..." />
                            <TextBlock x:Name="OllamaStatusText" 
                                      Text="Click 'Refresh Models' to load available models"
                                      Style="{ThemeResource CaptionTextBlockStyle}"
                                      Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Loading Overlay -->
                    <Border x:Name="OllamaLoadingOverlay"
                            Background="{ThemeResource LayerFillColorDefaultBrush}"
                            Opacity="0.9"
                            Visibility="Collapsed">
                        <StackPanel HorizontalAlignment="Center" 
                                   VerticalAlignment="Center" 
                                   Spacing="16">
                            <ProgressRing x:Name="OllamaProgressRing" 
                                         IsActive="False"
                                         Width="48"
                                         Height="48" />
                            <TextBlock x:Name="OllamaLoadingText"
                                      Text="Connecting to Ollama..."
                                      HorizontalAlignment="Center"
                                      Style="{ThemeResource BodyTextBlockStyle}" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
